package com.ares.hack.hacks.exploit;

import com.ares.utils.chat.ChatUtils;
import java.util.Map;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import java.util.Iterator;
import java.util.Set;
import com.ares.api.MojangWebApi;
import java.util.HashSet;
import net.minecraft.network.play.server.SPacketPlayerListItem;
import com.ares.event.packet.PacketRecieved;
import java.util.UUID;
import java.util.HashMap;
import com.ares.hack.categories.EnumCategory;
import com.ares.hack.hacks.BaseHack;

@Hack(name = "Vanish Detector", description = "Detect players in vanish", category = EnumCategory.EXPLOIT)
public class VanishDetector extends BaseHack
{
    private final HashMap<UUID, String> stillToAlert;
    
    public VanishDetector() {
        this.stillToAlert = new HashMap<UUID, String>();
    }
    
    @SubscribeEvent
    public void onReceivePacket(final PacketRecieved v-1) {
        /*SL:21*/if (v-1.packet instanceof SPacketPlayerListItem && this.getEnabled()) {
            final SPacketPlayerListItem v0 = /*EL:23*/(SPacketPlayerListItem)v-1.packet;
            /*SL:25*/if (v0.func_179768_b() == SPacketPlayerListItem.Action.UPDATE_LATENCY) {
                final Set<UUID> v = /*EL:27*/new HashSet<UUID>();
                /*SL:29*/for (final SPacketPlayerListItem.AddPlayerData a1 : v0.func_179767_a()) {
                    /*SL:31*/if (VanishDetector.mc.func_147114_u().func_175102_a(a1.func_179962_a().getId()) == null) {
                        /*SL:33*/v.add(a1.func_179962_a().getId());
                    }
                }
                final Iterator<UUID> iterator2;
                UUID a2;
                /*SL:37*/new Thread(() -> {
                    v.iterator();
                    while (iterator2.hasNext()) {
                        a2 = iterator2.next();
                        this.stillToAlert.put(a2, MojangWebApi.grabRealName(a2.toString()));
                    }
                }, "Vanish thing idk").start();
            }
        }
    }
    
    public void onLogic() {
        /*SL:51*/synchronized (this.stillToAlert) {
            /*SL:53*/for (final Map.Entry<UUID, String> v1 : this.stillToAlert.entrySet()) {
                /*SL:55*/ChatUtils.printMessage("PlayerPreviewElement " + v1.getValue() + " has gone into vanish (" + v1.getKey() + ")", "gold");
            }
            /*SL:58*/this.stillToAlert.clear();
        }
    }
}
